<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKIaaS Architecture Overview - PKI Documentation</title>
    <meta name="description" content="PKIaaS is built as a scalable, enterprise-grade Public Key Infrastructure service using Laravel 12 with comprehensive protocol support and Microsoft e">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#EEF2FF',
                            100: '#E0E7FF',
                            200: '#C7D2FE',
                            300: '#A5B4FC',
                            400: '#818CF8',
                            500: '#1E3A8A',
                            600: '#1E40AF',
                            700: '#1E3A8A',
                            800: '#1E3A8A',
                            900: '#1E3A8A'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4 { font-family: 'Poppins', sans-serif; }
        code, pre { font-family: 'Fira Code', monospace; }

        .prose h1 { @apply text-4xl font-bold text-gray-900 mb-6 mt-8; }
        .prose h2 { @apply text-3xl font-bold text-gray-900 mb-4 mt-6; }
        .prose h3 { @apply text-2xl font-bold text-gray-900 mb-3 mt-5; }
        .prose h4 { @apply text-xl font-semibold text-gray-900 mb-2 mt-4; }
        .prose p { @apply text-gray-700 mb-4 leading-relaxed; }
        .prose ul { @apply list-disc list-inside mb-4 text-gray-700; }
        .prose ol { @apply list-decimal list-inside mb-4 text-gray-700; }
        .prose li { @apply mb-2; }
        .prose a { @apply text-primary-700 hover:text-primary-900 underline; }
        .prose code { @apply bg-gray-100 px-2 py-1 rounded text-sm text-gray-800; }
        .prose pre { @apply bg-gray-900 p-4 rounded-lg overflow-x-auto mb-4; }
        .prose pre code { @apply bg-transparent px-0 py-0 text-gray-100; }
        .prose blockquote { @apply border-l-4 border-primary-500 pl-4 italic text-gray-700 mb-4; }
        .prose table { @apply w-full border-collapse mb-4; }
        .prose th { @apply bg-primary-100 text-primary-900 font-semibold p-2 border border-gray-300; }
        .prose td { @apply p-2 border border-gray-300; }

        /* Sidebar active link */
        .nav-link.active { @apply bg-primary-100 text-primary-900 font-semibold; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-3">
                    <a href="/index.html" class="flex items-center space-x-3">
                        <svg class="h-8 w-8 text-primary-700" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                        </svg>
                        <span class="text-2xl font-bold text-primary-700">PKI</span>
                    </a>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="/index.html" class="text-gray-700 hover:text-primary-700">Home</a>
                    <a href="/docs/README.html" class="text-gray-700 hover:text-primary-700">Documentation</a>
                    <a href="https://github.com/rdemsystems/pki" target="_blank" class="text-gray-700 hover:text-primary-700">GitHub</a>
                    <a href="https://www.rdem-systems.com/contact" class="bg-primary-700 text-white px-4 py-2 rounded-md hover:bg-primary-800">Support</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white shadow-lg min-h-screen sticky top-16 overflow-y-auto">
            <div class="p-6">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Documentation</h3>
                <nav class="space-y-1">
                    <div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">General</h4>
<a href="/docs/architecture-comparison-unified-vs-distributed.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Architecture Comparison Unified Vs Distributed</a>
<a href="/docs/COMMUNITY_BENEFITS.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Community Benefits</a>
<a href="/docs/LICENSE.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">License</a>
<a href="/docs/ci-parallelization-strategy.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Ci Parallelization Strategy</a>
<a href="/docs/standards-compliance.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Standards Compliance</a>
<a href="/docs/README.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Readme</a>
<a href="/docs/architecture-overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Architecture Overview</a>
<a href="/docs/gitlab-branch-protection.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Gitlab Branch Protection</a>
<a href="/docs/automatic-certificate-issuance-protocols.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Automatic Certificate Issuance Protocols</a>
<a href="/docs/features-matrix.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Features Matrix</a>
<a href="/docs/gitlab-deployment-instructions.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Gitlab Deployment Instructions</a>
</div>
<div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">security</h4>
<a href="/docs/security/nitrokey-implementation-analysis.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Nitrokey Implementation Analysis</a>
<a href="/docs/security/nitrokey-distributed-architecture.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Nitrokey Distributed Architecture</a>
<a href="/docs/security/security-audit-report.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Security Audit Report</a>
<a href="/docs/security/nitrokey-hsm-analysis.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Nitrokey Hsm Analysis</a>
<a href="/docs/security/CA_TRUST_FLAGS_SPECIFICATION.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Ca Trust Flags Specification</a>
<a href="/docs/security/fips-140-2-analysis.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Fips 140 2 Analysis</a>
<a href="/docs/security/CA_PASSWORD_WORKFLOW_SPEC.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Ca Password Workflow Spec</a>
<a href="/docs/security/implementation-summary.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Implementation Summary</a>
<a href="/docs/security/opensource-release-review.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Opensource Release Review</a>
</div>
<div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">business</h4>
<a href="/docs/business/commercial-arguments.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Commercial Arguments</a>
</div>
<div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">integrations</h4>
<a href="/docs/integrations/entra-id.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Entra Id</a>
</div>
<div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">protocols</h4>
<a href="/docs/protocols/scep.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Scep</a>
</div>
<div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">features</h4>
<a href="/docs/features/entra-id-integration/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/user-requests/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/certificate-management/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/certificate-management/auto-renewal.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Auto Renewal</a>
<a href="/docs/features/certificate-management/csr-issuance.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Csr Issuance</a>
<a href="/docs/features/certificate-management/api-auto-renewal.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Auto Renewal</a>
<a href="/docs/features/certificate-management/api-certificate-issuance.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Certificate Issuance</a>
<a href="/docs/features/certificate-management/acme-integration.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Acme Integration</a>
<a href="/docs/features/certificate-management/api-crl-management.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Crl Management</a>
<a href="/docs/features/authentication/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/ocsp-responder/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/approval-management/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/dashboard-monitoring/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/dashboard-monitoring/api-system-health.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api System Health</a>
<a href="/docs/features/user-access-management/user-management.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">User Management</a>
<a href="/docs/features/user-access-management/ca-access-policies.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Ca Access Policies</a>
<a href="/docs/features/user-access-management/user-profile.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">User Profile</a>
<a href="/docs/features/ca-management/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/ca-management/ca-groups.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Ca Groups</a>
<a href="/docs/features/ca-management/api-ca-management-crud.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Ca Management Crud</a>
<a href="/docs/features/ca-management/api-ca-password-management.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Ca Password Management</a>
<a href="/docs/features/ca-management/api-ca-management.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Ca Management</a>
<a href="/docs/features/ca-management/ca-rotation.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Ca Rotation</a>
<a href="/docs/features/ca-management/api-ca-rotation.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Api Ca Rotation</a>
<a href="/docs/features/auditing/security-audits.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Security Audits</a>
<a href="/docs/features/auditing/audit-logs.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Audit Logs</a>
<a href="/docs/features/scep-protocol-integration/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/est-protocol-integration/overview.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Overview</a>
<a href="/docs/features/integrations/acme-server-implementation.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Acme Server Implementation</a>
<a href="/docs/features/integrations/windows-8021x-integration.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Windows 8021X Integration</a>
<a href="/docs/features/integrations/openvpn-integration.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Openvpn Integration</a>
</div>
<div class="mb-4">
<h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">architecture</h4>
<a href="/docs/architecture/pki-url-management.html" class="nav-link block px-3 py-2 rounded-md text-sm text-gray-700 hover:bg-gray-100 ">Pki Url Management</a>
</div>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 max-w-4xl">
            <div class="prose">
                <h1 id="pkiaas-architecture-overview">PKIaaS Architecture Overview</h1>
<h2 id="system-architecture">System Architecture</h2>
<p>PKIaaS is built as a scalable, enterprise-grade Public Key Infrastructure service using Laravel 12 with comprehensive protocol support and Microsoft enterprise integration.</p>
<h3 id="core-components">Core Components</h3>
<div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">TD</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Web</span><span class="w"> </span><span class="n">Interface</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Laravel</span><span class="w"> </span><span class="n">Application</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Certificate</span><span class="w"> </span><span class="n">Authority</span><span class="w"> </span><span class="n">Management</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Certificate</span><span class="w"> </span><span class="n">Lifecycle</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Protocol</span><span class="w"> </span><span class="n">Services</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Integration</span><span class="w"> </span><span class="n">Services</span><span class="p">]</span>

<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">G</span><span class="p">[</span><span class="n">Root</span><span class="w"> </span><span class="n">CA</span><span class="p">]</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">H</span><span class="p">[</span><span class="n">Intermediate</span><span class="w"> </span><span class="n">CAs</span><span class="p">]</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">I</span><span class="p">[</span><span class="n">Certificate</span><span class="w"> </span><span class="n">Profiles</span><span class="p">]</span>

<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">J</span><span class="p">[</span><span class="n">Certificate</span><span class="w"> </span><span class="n">Generation</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">[</span><span class="n">Auto</span><span class="o">-</span><span class="n">Renewal</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">L</span><span class="p">[</span><span class="n">Revocation</span><span class="w"> </span><span class="n">Management</span><span class="p">]</span>

<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">[</span><span class="n">OCSP</span><span class="w"> </span><span class="n">Responder</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">N</span><span class="p">[</span><span class="n">SCEP</span><span class="w"> </span><span class="n">Server</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">O</span><span class="p">[</span><span class="n">EST</span><span class="w"> </span><span class="n">Server</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="n">ACME</span><span class="w"> </span><span class="n">Server</span><span class="p">]</span>

<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="n">Entra</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="n">Integration</span><span class="p">]</span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">R</span><span class="p">[</span><span class="n">External</span><span class="w"> </span><span class="n">Database</span><span class="p">]</span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">S</span><span class="p">[</span><span class="n">Notification</span><span class="w"> </span><span class="n">System</span><span class="p">]</span>
</code></pre></div>

<h3 id="protocol-support-matrix">Protocol Support Matrix</h3>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Purpose</th>
<th>RFC Standard</th>
<th>Status</th>
<th>Microsoft Compatibility</th>
</tr>
</thead>
<tbody>
<tr>
<td>OCSP</td>
<td>Certificate Validation</td>
<td>RFC 6960</td>
<td>✅ Complete</td>
<td>Full</td>
</tr>
<tr>
<td>SCEP</td>
<td>Device Enrollment</td>
<td>RFC 8894</td>
<td>✅ Complete</td>
<td>Intune Compatible</td>
</tr>
<tr>
<td>EST</td>
<td>Enterprise Enrollment</td>
<td>RFC 7030</td>
<td>✅ Complete</td>
<td>Full</td>
</tr>
<tr>
<td>ACME</td>
<td>Automated Enrollment</td>
<td>RFC 8555</td>
<td>✅ Complete</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h3 id="security-architecture">Security Architecture</h3>
<div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">LR</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Client</span><span class="w"> </span><span class="n">Request</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Load</span><span class="w"> </span><span class="n">Balancer</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Web</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="n">Firewall</span><span class="p">]</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Authentication</span><span class="w"> </span><span class="n">Layer</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Authorization</span><span class="w"> </span><span class="n">Engine</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">PKI</span><span class="w"> </span><span class="n">Services</span><span class="p">]</span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">G</span><span class="p">[</span><span class="n">HSM</span><span class="o">/</span><span class="n">Cryptographic</span><span class="w"> </span><span class="n">Storage</span><span class="p">]</span>

<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">H</span><span class="p">[</span><span class="n">Entra</span><span class="w"> </span><span class="n">ID</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">I</span><span class="p">[</span><span class="n">Local</span><span class="w"> </span><span class="n">Authentication</span><span class="p">]</span>

<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">J</span><span class="p">[</span><span class="n">Role</span><span class="o">-</span><span class="n">Based</span><span class="w"> </span><span class="n">Access</span><span class="w"> </span><span class="n">Control</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">K</span><span class="p">[</span><span class="n">API</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="n">Management</span><span class="p">]</span>
</code></pre></div>

<h2 id="deployment-architecture">Deployment Architecture</h2>
<h3 id="multi-instance-docker-setup">Multi-Instance Docker Setup</h3>
<p>The system supports horizontal scaling with multiple application instances:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app-1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkiaas:latest</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INSTANCE_ID=instance-1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_REPLICAS=3</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8443:443&quot;</span>

<span class="w">  </span><span class="nt">app-2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkiaas:latest</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INSTANCE_ID=instance-2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_REPLICAS=3</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:80&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8444:443&quot;</span>

<span class="w">  </span><span class="nt">proxy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:443&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx.conf:/etc/nginx/nginx.conf</span>
</code></pre></div>

<h3 id="database-architecture">Database Architecture</h3>
<h4 id="external-mariadb-recommended-for-production">External MariaDB (Recommended for Production)</h4>
<div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">TB</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Application</span><span class="w"> </span><span class="n">Instances</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Load</span><span class="w"> </span><span class="n">Balancer</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Galera</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Galera</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Galera</span><span class="w"> </span><span class="n">Cluster</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span>

<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">&lt;--&gt;</span><span class="w"> </span><span class="n">D</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">&lt;--&gt;</span><span class="w"> </span><span class="n">E</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">&lt;--&gt;</span><span class="w"> </span><span class="n">C</span>
</code></pre></div>

<p><strong>Configuration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">DB_HOST</span><span class="o">=</span>galera-cluster.domain.com
<span class="nv">DB_CONNECTION</span><span class="o">=</span>mysql
<span class="nv">DB_DATABASE</span><span class="o">=</span>pkiaas
</code></pre></div>

<h4 id="local-mariadb-development">Local MariaDB (Development)</h4>
<p>For development environments, a local MariaDB container is provided:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">db</span><span class="p">:</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:11</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MYSQL_ROOT_PASSWORD}</span>
<span class="w">    </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_DATABASE}</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;${DB_EXTERNAL_PORT:-3307}:3306&quot;</span>
</code></pre></div>

<h3 id="resource-management">Resource Management</h3>
<h4 id="docker-resource-limits">Docker Resource Limits</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0&#39;</span>
<span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>

<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>

<span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
<span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
<span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</code></pre></div>

<h2 id="service-architecture">Service Architecture</h2>
<h3 id="core-services">Core Services</h3>
<h4 id="cryptoservice">CryptoService</h4>
<p><strong>Purpose</strong>: Core cryptographic operations
<strong>Responsibilities</strong>:
- Certificate generation and signing
- CRL generation and management
- Key pair generation
- Cryptographic validation</p>
<h4 id="ocspservice">OcspService</h4>
<p><strong>Purpose</strong>: Online Certificate Status Protocol responder
<strong>Features</strong>:
- Real-time certificate status checking
- ASN.1 DER encoding/decoding
- Nonce support for replay protection
- Multiple hash algorithm support</p>
<h4 id="scepservice">ScepService</h4>
<p><strong>Purpose</strong>: Simple Certificate Enrollment Protocol
<strong>Features</strong>:
- Microsoft Intune compatibility
- PKCS#7 message handling
- Challenge password authentication
- Certificate renewal support</p>
<h4 id="estservice">EstService</h4>
<p><strong>Purpose</strong>: Enrollment over Secure Transport
<strong>Features</strong>:
- TLS client certificate authentication
- Enterprise enrollment workflows
- RESTful API design
- Certificate attribute support</p>
<h4 id="autorenewalservice">AutoRenewalService</h4>
<p><strong>Purpose</strong>: Automated certificate lifecycle management
<strong>Features</strong>:
- Eligibility assessment
- Batch processing
- Notification system
- Failure handling and retry logic</p>
<h4 id="entraidservice">EntraIdService</h4>
<p><strong>Purpose</strong>: Microsoft Entra ID integration
<strong>Features</strong>:
- User synchronization
- Group-based role mapping
- Certificate provisioning
- JWT token validation</p>
<h3 id="api-architecture">API Architecture</h3>
<h4 id="restful-api-design">RESTful API Design</h4>
<div class="codehilite"><pre><span></span><code>/api/v1/
├── certificates/                 # Certificate management
├── certificate-authorities/      # CA management
├── ocsp/                        # OCSP responder
├── scep/                        # SCEP enrollment
├── est/                         # EST enrollment
├── acme/                        # ACME protocol
├── auto-renewal/                # Auto-renewal management
└── entra-id/                    # Entra ID integration
</code></pre></div>

<h4 id="authentication-methods">Authentication Methods</h4>
<ol>
<li><strong>API Keys (Sanctum)</strong></li>
<li>Stateless authentication</li>
<li>Rate limiting support</li>
<li>
<p>Scope-based permissions</p>
</li>
<li>
<p><strong>Entra ID Bearer Tokens</strong></p>
</li>
<li>JWT validation</li>
<li>Microsoft Graph integration</li>
<li>
<p>Group-based authorization</p>
</li>
<li>
<p><strong>Certificate-based Authentication</strong></p>
</li>
<li>mTLS for EST protocol</li>
<li>Certificate binding</li>
<li>Hardware token support</li>
</ol>
<h3 id="data-architecture">Data Architecture</h3>
<h4 id="database-schema">Database Schema</h4>
<div class="codehilite"><pre><span></span><code><span class="n">erDiagram</span>
<span class="w">    </span><span class="n">certificate_authorities</span><span class="w"> </span><span class="o">||--</span><span class="n">o</span><span class="p">{</span><span class="w"> </span><span class="n">certificates</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">issues</span>
<span class="w">    </span><span class="n">certificates</span><span class="w"> </span><span class="o">||--</span><span class="n">o</span><span class="p">{</span><span class="w"> </span><span class="n">certificate_revocations</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">revoked</span>
<span class="w">    </span><span class="n">certificates</span><span class="w"> </span><span class="p">}</span><span class="n">o</span><span class="o">--||</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">owner</span>
<span class="w">    </span><span class="n">users</span><span class="w"> </span><span class="p">}</span><span class="n">o</span><span class="o">--</span><span class="n">o</span><span class="p">{</span><span class="w"> </span><span class="n">user_client_contexts</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">contexts</span>

<span class="w">    </span><span class="n">certificate_authorities</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="n">bigint</span>
<span class="w">        </span><span class="n">type</span><span class="w"> </span><span class="k">enum</span>
<span class="w">        </span><span class="n">common_name</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">private_key</span><span class="w"> </span><span class="n">text</span>
<span class="w">        </span><span class="n">certificate</span><span class="w"> </span><span class="n">text</span>
<span class="w">        </span><span class="n">is_active</span><span class="w"> </span><span class="n">boolean</span>
<span class="w">        </span><span class="n">parent_ca_id</span><span class="w"> </span><span class="n">bigint</span>
<span class="w">        </span><span class="n">valid_from</span><span class="w"> </span><span class="n">timestamp</span>
<span class="w">        </span><span class="n">valid_to</span><span class="w"> </span><span class="n">timestamp</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">certificates</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="n">bigint</span>
<span class="w">        </span><span class="n">ca_id</span><span class="w"> </span><span class="n">bigint</span>
<span class="w">        </span><span class="n">type</span><span class="w"> </span><span class="k">enum</span>
<span class="w">        </span><span class="n">serial_number</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">common_name</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">private_key</span><span class="w"> </span><span class="n">text</span>
<span class="w">        </span><span class="n">certificate</span><span class="w"> </span><span class="n">text</span>
<span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="k">enum</span>
<span class="w">        </span><span class="n">valid_from</span><span class="w"> </span><span class="n">timestamp</span>
<span class="w">        </span><span class="n">valid_to</span><span class="w"> </span><span class="n">timestamp</span>
<span class="w">        </span><span class="n">auto_renewal_enabled</span><span class="w"> </span><span class="n">boolean</span>
<span class="w">        </span><span class="n">entra_user_id</span><span class="w"> </span><span class="n">bigint</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">users</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="n">bigint</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">email</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">entra_id</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">entra_upn</span><span class="w"> </span><span class="n">varchar</span>
<span class="w">        </span><span class="n">is_active</span><span class="w"> </span><span class="n">boolean</span>
<span class="w">        </span><span class="n">entra_last_sync</span><span class="w"> </span><span class="n">timestamp</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<h4 id="performance-optimization">Performance Optimization</h4>
<p><strong>Database Indexes:</strong>
- Certificate status and expiration queries
- OCSP serial number lookups
- Entra ID user mapping
- Auto-renewal eligibility checks</p>
<p><strong>Caching Strategy:</strong>
- Redis for session management
- Certificate chain caching
- OCSP response caching
- Entra ID token caching</p>
<h2 id="security-architecture_1">Security Architecture</h2>
<h3 id="cryptographic-standards">Cryptographic Standards</h3>
<h4 id="supported-algorithms">Supported Algorithms</h4>
<p><strong>Asymmetric Encryption:</strong>
- RSA: 2048, 3072, 4096 bits
- ECDSA: P-256, P-384, P-521 curves (future)</p>
<p><strong>Hash Algorithms:</strong>
- SHA-256 (default)
- SHA-384
- SHA-512</p>
<p><strong>Symmetric Encryption:</strong>
- AES-256-CBC (private key encryption)
- AES-256-GCM (data encryption)</p>
<h4 id="key-management">Key Management</h4>
<div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">TD</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Key</span><span class="w"> </span><span class="n">Generation</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Secure</span><span class="w"> </span><span class="n">Storage</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Usage</span><span class="w"> </span><span class="n">Control</span><span class="p">]</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Rotation</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Archive</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Destruction</span><span class="p">]</span>

<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">G</span><span class="p">[</span><span class="n">Database</span><span class="w"> </span><span class="n">Encryption</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">H</span><span class="p">[</span><span class="n">HSM</span><span class="w"> </span><span class="n">Integration</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">I</span><span class="p">[</span><span class="n">Backup</span><span class="w"> </span><span class="n">Encryption</span><span class="p">]</span>
</code></pre></div>

<h3 id="access-control">Access Control</h3>
<h4 id="role-based-access-control-rbac">Role-Based Access Control (RBAC)</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">roles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pki-admin</span><span class="p">:</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create-ca</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manage-certificates</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">view-all-certificates</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">revoke-certificates</span>

<span class="w">  </span><span class="nt">certificate-manager</span><span class="p">:</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create-certificates</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">view-own-certificates</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">renew-certificates</span>

<span class="w">  </span><span class="nt">operator</span><span class="p">:</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">view-certificates</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">download-certificates</span>

<span class="w">  </span><span class="nt">user</span><span class="p">:</span>
<span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request-certificates</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">view-own-certificates</span>
</code></pre></div>

<h4 id="api-security">API Security</h4>
<p><strong>Rate Limiting:</strong>
- 100 requests/minute for OCSP
- 60 requests/minute for SCEP
- 10 certificates/hour per IP
- 50 certificates/day per user</p>
<p><strong>Input Validation:</strong>
- CSR format validation
- Subject DN validation
- Extension validation
- Size limits on all inputs</p>
<h2 id="monitoring-and-observability">Monitoring and Observability</h2>
<h3 id="health-monitoring">Health Monitoring</h3>
<h4 id="service-health-checks">Service Health Checks</h4>
<div class="codehilite"><pre><span></span><code><span class="x">// Health check endpoints</span>
<span class="x">/api/v1/ocsp/health      // OCSP service status</span>
<span class="x">/api/v1/scep/health      // SCEP service status</span>
<span class="x">/api/v1/est/health       // EST service status</span>
<span class="x">/api/v1/auto-renewal/health  // Auto-renewal status</span>
<span class="x">/api/v1/entra-id/health  // Entra ID integration</span>
</code></pre></div>

<h4 id="system-metrics">System Metrics</h4>
<ul>
<li>Certificate issuance rates</li>
<li>Protocol usage statistics</li>
<li>Error rates and response times</li>
<li>Database performance metrics</li>
<li>Cache hit ratios</li>
</ul>
<h3 id="logging-architecture">Logging Architecture</h3>
<h4 id="structured-logging">Structured Logging</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ocsp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;certificate_status_request&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;serial_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;good&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;response_time_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;client_ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.100&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="log-categories">Log Categories</h4>
<ol>
<li><strong>Security Events</strong></li>
<li>Authentication attempts</li>
<li>Authorization failures</li>
<li>Certificate operations</li>
<li>
<p>System configuration changes</p>
</li>
<li>
<p><strong>Operational Events</strong></p>
</li>
<li>Service health status</li>
<li>Performance metrics</li>
<li>Error conditions</li>
<li>
<p>Maintenance activities</p>
</li>
<li>
<p><strong>Audit Events</strong></p>
</li>
<li>Certificate lifecycle events</li>
<li>Administrative actions</li>
<li>Compliance-related activities</li>
<li>Data access logs</li>
</ol>
<h2 id="scalability-and-performance">Scalability and Performance</h2>
<h3 id="horizontal-scaling">Horizontal Scaling</h3>
<h4 id="load-balancing-strategy">Load Balancing Strategy</h4>
<div class="codehilite"><pre><span></span><code><span class="k">upstream</span><span class="w"> </span><span class="s">pkiaas_backend</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="n">app-1</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="n">app-2</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="n">app-3</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://pkiaas_backend</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="session-management">Session Management</h4>
<ul>
<li>Redis-based session storage</li>
<li>Stateless API design</li>
<li>Session affinity for web interface</li>
<li>Distributed caching</li>
</ul>
<h3 id="performance-optimization_1">Performance Optimization</h3>
<h4 id="database-optimization">Database Optimization</h4>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Certificate lookup optimization</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_certificates_serial</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">certificates</span><span class="p">(</span><span class="n">serial_number</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_certificates_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">certificates</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_certificates_expiry</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">certificates</span><span class="p">(</span><span class="n">valid_to</span><span class="p">);</span>

<span class="c1">-- OCSP performance</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_revocations_serial</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">certificate_revocations</span><span class="p">(</span><span class="n">serial_number</span><span class="p">);</span>

<span class="c1">-- Auto-renewal performance</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_auto_renewal_eligible</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">certificates</span><span class="p">(</span><span class="n">auto_renewal_enabled</span><span class="p">,</span><span class="w"> </span><span class="n">valid_to</span><span class="p">);</span>
</code></pre></div>

<h4 id="caching-strategy">Caching Strategy</h4>
<ul>
<li>Certificate chains: 1 hour TTL</li>
<li>CRL responses: 30 minutes TTL</li>
<li>OCSP responses: 5 minutes TTL</li>
<li>User sessions: 2 hours TTL</li>
</ul>
<h2 id="disaster-recovery">Disaster Recovery</h2>
<h3 id="backup-strategy">Backup Strategy</h3>
<h4 id="database-backups">Database Backups</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Daily full backup</span>
mysqldump<span class="w"> </span>pkiaas<span class="w"> </span>&gt;<span class="w"> </span>backup_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.sql

<span class="c1"># Hourly incremental backups</span>
mysqlbinlog<span class="w"> </span>--start-datetime<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;1 hour ago&#39;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/var/log/mysql/mysql-bin.log<span class="w"> </span>&gt;<span class="w"> </span>incremental_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H<span class="k">)</span>.sql
</code></pre></div>

<h4 id="key-material-backup">Key Material Backup</h4>
<ul>
<li>Encrypted CA private keys</li>
<li>Certificate database</li>
<li>Configuration files</li>
<li>Log archives</li>
</ul>
<h3 id="recovery-procedures">Recovery Procedures</h3>
<ol>
<li><strong>Service Recovery</strong></li>
<li>Container restart procedures</li>
<li>Database restoration</li>
<li>Configuration restoration</li>
<li>
<p>Certificate validation</p>
</li>
<li>
<p><strong>CA Recovery</strong></p>
</li>
<li>Root CA restoration</li>
<li>Intermediate CA recovery</li>
<li>Certificate reissuance</li>
<li>CRL regeneration</li>
</ol>
<h2 id="integration-patterns">Integration Patterns</h2>
<h3 id="microsoft-enterprise-integration">Microsoft Enterprise Integration</h3>
<h4 id="entra-id-authentication-flow">Entra ID Authentication Flow</h4>
<div class="codehilite"><pre><span></span><code><span class="n">sequenceDiagram</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">Client</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">PKIaaS</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">EntraID</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">MicrosoftGraph</span>

<span class="w">    </span><span class="n">Client</span><span class="o">-&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Bearer</span><span class="w"> </span><span class="kt">Token</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">-&gt;&gt;</span><span class="n">EntraID</span><span class="o">:</span><span class="w"> </span><span class="kr">Validate</span><span class="w"> </span><span class="n">JWT</span><span class="w"> </span><span class="kt">Token</span>
<span class="w">    </span><span class="n">EntraID</span><span class="o">--&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="kt">Token</span><span class="w"> </span><span class="n">Valid</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">-&gt;&gt;</span><span class="n">MicrosoftGraph</span><span class="o">:</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">Info</span>
<span class="w">    </span><span class="n">MicrosoftGraph</span><span class="o">--&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">Details</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">-&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="n">Sync</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Roles</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">--&gt;&gt;</span><span class="n">Client</span><span class="o">:</span><span class="w"> </span><span class="n">Authenticated</span><span class="w"> </span><span class="n">Response</span>
</code></pre></div>

<h4 id="device-enrollment-scep">Device Enrollment (SCEP)</h4>
<div class="codehilite"><pre><span></span><code><span class="n">sequenceDiagram</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">Device</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">Intune</span>
<span class="w">    </span><span class="n">participant</span><span class="w"> </span><span class="n">PKIaaS</span>

<span class="w">    </span><span class="n">Device</span><span class="o">-&gt;&gt;</span><span class="n">Intune</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="n">Certificate</span><span class="w"> </span><span class="n">Profile</span>
<span class="w">    </span><span class="n">Intune</span><span class="o">-&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="n">SCEP</span><span class="w"> </span><span class="n">GetCACert</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">--&gt;&gt;</span><span class="n">Intune</span><span class="o">:</span><span class="w"> </span><span class="n">CA</span><span class="w"> </span><span class="n">Certificate</span>
<span class="w">    </span><span class="n">Device</span><span class="o">-&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="n">SCEP</span><span class="w"> </span><span class="n">PKIOperation</span><span class="w"> </span><span class="p">(</span><span class="n">CSR</span><span class="p">)</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">-&gt;&gt;</span><span class="n">PKIaaS</span><span class="o">:</span><span class="w"> </span><span class="kr">Validate</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Issue</span><span class="w"> </span><span class="n">Certificate</span>
<span class="w">    </span><span class="n">PKIaaS</span><span class="o">--&gt;&gt;</span><span class="n">Device</span><span class="o">:</span><span class="w"> </span><span class="n">PKCS</span><span class="err">#</span><span class="mi">7</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Certificate</span>
</code></pre></div>

<p>This architecture provides a robust, scalable, and secure foundation for enterprise PKI services with comprehensive protocol support and Microsoft integration capabilities.</p>
            </div>

            <!-- Footer -->
            <footer class="mt-12 pt-8 border-t border-gray-200 text-sm text-gray-600">
                <p>Last updated: 2025-10-04</p>
                <p class="mt-2">
                    <a href="https://github.com/rdemsystems/pki" target="_blank" class="text-primary-700 hover:text-primary-900">Edit this page on GitHub</a>
                </p>
            </footer>
        </main>
    </div>

    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
</body>
</html>
